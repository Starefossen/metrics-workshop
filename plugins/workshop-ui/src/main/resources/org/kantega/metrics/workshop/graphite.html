#section("content")
    <div class="row">
        <h1 class="extruded">Publishing metrics to Graphite</h1>

        <p>
            Your task is publish metrics to <a target="_blank" href="http://graphite.readthedocs.org">Graphite</a>.
        </p>

        <p>
            Graphite can be complex to setup. So for this task you should use <a target="_blank" href="https://docker.io">Docker</a>,
            please follow the <a target="_blank" href="https://docs.docker.com/installation/">Installation</a> process for your system.
        </p>

        <p>
            When Docker has been installed run the following command:<br>

            <code>sudo docker pull hopsoft/graphite-statsd</code><br><br>

            or if copied from USB use:<br>
            <code>sudo docker load < graphite.tar</code><br><br>

            Then start the image by running:<br>

            <code>sudo docker run -d   --name graphite   -p 80:80   -p 2003:2003   -p 8125:8125/udp   hopsoft/graphite-statsd</code>
        </p>

        <p>
            Finally you need to setup an Graphite Reporter in <code>MetricsPlugin.java</code>.
        </p>


        <h2>Test results:</h2>

        <p id="yespublish" style="display: none">
            YES! You have successfully published metrics to Graphite.
        </p>

        <p id="nopublish" style="display: none">
            FAIL! You have not yet published metrics to Graphite.
        </p>

        <div id="done" style="display: none;">
            <div id="video"></div>
            <p></p>
            <p>
                Did he also mention... developers?<a href="."> Now, choose one of the other 7</a>
            </p>
        </div>


        <script>
            function analyze(url, ready) {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", url, false);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4) {
                        ready(xhr.responseText);
                    }
                };
                xhr.send(null);
            }

            function analyzeJSON(url, ready) {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", url, false);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4) {
                        ready(JSON.parse(xhr.responseText));
                    }
                };
                xhr.send(null);
            }

            analyze("http://localhost/", function(graphite) {

                if(graphite.length == 0) {
                    alert("This test assumes you have setup graphite web interface on http://localhost:80")
                } else {
                    analyzeJSON("http://localhost/render?target=heap.used&format=json", function(metrics){

                        if(metrics.length == 0){
                            document.querySelector("#nopublish").style.display = "block";
                        } else {
                            var heap = metrics[0].target;

                            if(!heap){
                                document.querySelector("#nopublish").style.display = "block";
                            }else {
                                document.querySelector("#yespublish").style.display = "block";
                                document.querySelector("#done").style.display = "block";
                                document.querySelector("#video").innerHTML='<iframe width="420" height="315" src="https://www.youtube.com/embed/8To-6VIJZRE?autoplay=1" frameborder="0" allowfullscreen></iframe>';
                            }

                        }
                    });

                }

            });

        </script>

    </div>
#end
#parse("design.html")